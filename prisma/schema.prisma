// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  password  String
  email     String   @unique
  cpf       String   @unique
  name      String
  status    String // enum
  date      DateTime
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  Rule Rule[]

  @@map("user")
}

model Resource {
  id   Int    @id @default(autoincrement())
  name String @unique

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  Rule Rule[]

  @@map("resource")
}

model Rule {
  id         Int    @id @default(autoincrement())
  permission String // read, write, delete
  userId     String
  resourceId Int
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user     User     @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  resource Resource @relation(fields: [resourceId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@unique([userId, resourceId])
  @@map("rule")
}

model Consultation {
  id                 Int      @id @default(autoincrement())
  date               DateTime
  animalId           String
  medicalSpecialtyId Int
  newCase            Boolean // newcase or retunvisit
  procedureType      String // simple, complex, Intensive Care Unit
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  animal           Animal           @relation(fields: [animalId], references: [id])
  medicalSpecialty MedicalSpecialty @relation(fields: [medicalSpecialtyId], references: [id])

  @@map("consultation")
}

model Surgery {
  id                  Int      @id @default(autoincrement())
  animalId            String
  surgicalProcedureId Int
  date      DateTime
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  surgicalProcedure SurgicalProcedure @relation(fields: [surgicalProcedureId], references: [id])
  animal            Animal            @relation(fields: [animalId], references: [id])

  @@map("surgery")
}

model SurgicalProcedure {
  id          Int       @id @default(autoincrement())
  name        String    @unique
  description String
  type        String // simple, complex
  hide        Boolean
  surgery     Surgery[]
  date      DateTime

  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("surgical_procedure")
}

model Animal {
  id                   String                 @id @default(cuid()) // verificar o tipo do id
  name                 String?
  speciesId            Int
  birthDate            DateTime?
  sex                  String // enum
  weight               Float
  ownerCpf             String
  ownerName            String
  surgery              Surgery[]
  consultation         Consultation[]
  laboratoryExamReport LaboratoryExamReport[]
  imageExamReport      ImageExamReport[]
  necropsy             necropsy[]
  date      DateTime
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  species Species @relation(fields: [speciesId], references: [id])

  @@map("animal")
}

model Species {
  id             Int      @id @default(autoincrement())
  name           String   @unique
  classification String   // small animal, large animal, wild animal
  description    String
  animal         Animal[]
  date      DateTime
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("species")
}

model MedicalSpecialty {
  id             Int            @id @default(autoincrement())
  name           String         @unique
  consultationId Int?
  consultation   Consultation[]
  hide           Boolean
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("medical_specialty")
}

model ImageExam {
  id              Int               @id @default(autoincrement())
  name            String
  description     String
  classification  String // simple, complex
  imageExamReport ImageExamReport[]
  date      DateTime
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("image_exam")
}

model LaboratoryExam {
  id                   Int                    @id @default(autoincrement())
  name                 String
  description          String
  LaboratoryExamReport LaboratoryExamReport[]
  date      DateTime
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("laboratory_exam")
}

model LaboratoryExamReport {
  id               Int    @id @default(autoincrement())
  report           String
  animalId         String
  laboratoryExamId Int
  date      DateTime
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  animail        Animal         @relation(fields: [animalId], references: [id])
  laboratoryExam LaboratoryExam @relation(fields: [laboratoryExamId], references: [id])

  @@map("laboratory_exam_report")
}

model ImageExamReport {
  id          Int    @id @default(autoincrement())
  report      String
  animalId    String
  imageExamId Int
  date      DateTime
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  imageExam ImageExam @relation(fields: [imageExamId], references: [id])
  animail   Animal    @relation(fields: [animalId], references: [id])

  @@map("image_exam_report")
}

model necropsy {
  id       Int      @id @default(autoincrement())
  animalId String
  report   String
  date      DateTime
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  animal Animal? @relation(fields: [animalId], references: [id])

  @@map("necropsy")
}
